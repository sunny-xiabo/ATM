"""
# -*- coding:utf-8 -*-
# @Author: Beck
# @File: test_run_test_designer.py
# @Date: 2025/8/28 15:31
"""

from src.agents.test_designer import TestDesignerAgent
from dotenv import load_dotenv

# 加载环境变量
load_dotenv()

if __name__ == "__main__":
    # 创建测试设计代理
    designer = TestDesignerAgent()

    # 准备需求数据
    requirements = {
        "original_doc": "简本溯源-资质证照⼀键整理 ⼀、背景及⽬标 •背景：⽬前智爱产品缺少亮眼的、市场上独⼀份的、让⽤⼾有记忆点的功能模块；现有功能模块， 都可以在竞品中找到相似功能。交易并购、IPO往往会涉及对⽬标公司各类业务资质（最常⻅的如 营业执照，税务登记许可证、建筑业资质）的整理归纳。 •⽬标：运⽤ai识别、提取资质证照的内容，⾃动摘录成表格，并且借助溯源功能，⽅便⽤⼾快速校 对、修改。 ⼆、架构及流程 三、功能清单 序号端/系统功能模 块⼀级场景⼆级场景功能点功能说明 优先 级 1主要是 PC。h5 和⼩程序 ⽀持优先 级靠后简本溯 源⾮诉场景- 尽职调查资质证照清单 ⼀键整理⽂件上传 •⽀持pdf和图⽚（其他格 式的资质证照很少⻅，忽 略） •⽀持批量拖动⽂件或点击 批量⽂件上传 •⽀持拖动⽂件夹或点击⽂ 件夹上传（不好做就先不 做）（p2） •成功上传的⽂件有状态标 记，如⼩绿点，上传失败 有弹窗提⽰p0 2 p1 上传⽂件 修改(删 除）在开始任务前，⽀持即时删 除、补充上传⽂件，以上传的 ⽂件线上保持展⽰ 3 任务列表 •有最近任务列表的展⽰ •后台任务执⾏功能 （参考合同审查）p0 4 查看结果 •后台任务执⾏完毕后，可 点击查看整理结果（参考 合同审查） •新开标签⻚，并以在线⽂ 档形式展⽰整理结果（参 考合同审查） •⽀持多表格展⽰，每⼀份 ⽂件提取的内容对应⼀个 表格分开展⽰，⾃动分割 •点击提取内容，以原始⽂ 件的图⽚快照⽅式展现内 容对应的来源出处（⽀持 切换⽅向）p0 5 修改结果 •线上展⽰时，每⼀个表格 有单独的修改按钮，点击 后，可对该表格内容进⾏ 修改 •点击修改后，右侧⾯拉出 修改⻚⾯，修改⻚⾯分两 部分，左边是提取的表格 （表格的标题和对应的提 取内容都需要⽀持修 改），右边是原始⽂件的 在线溯源查看（pdf⽂件 要⽀持下划切换⻚⾯的功 能，图⽚要⽀持下划切换 图⽚）（⽀持切换⽅向）P0 6 下载结果 •点击下载，默认格式为 word输出，⽂件名默认 为“未命名_xx⽇年xx⽉ xx⽇”p0 批量合同智能 摘录（总结）⻅其他prd 关键事件图谱⻅其他prd 资⾦流⽔（敬 请期待）【放 上去，但是先 不开发】仅前端涉及展⽰ 历史沿⾰（敬 请期待）【放 上去，但是先 不开发】仅前端涉及展⽰ 裁判⽂书阅读 （敬请期待） 【放上去，但 是先不开发】仅前端涉及展⽰ ⾮诉场景- 公司合规（敬请期待） 【放上去，但 是先不开发】仅前端涉及展⽰ ⾮诉场景- 上市并购（敬请期待） 【放上去，但 是先不开发】仅前端涉及展⽰ 诉讼场景关键事件图谱⻅其他prd 微信聊天记录⻅其他prd 邮件沟通记录 （敬请期待）仅前端涉及展⽰ 裁判⽂书阅读 （敬请期待） 【放上去，但 是先不开发】仅前端涉及展⽰ 资⾦流⽔（敬 请期待）【放 上去，但是先 不开发】仅前端涉及展⽰ 通⽤证据分析 （敬请期待） 【放上去，但 是先不开发】仅前端涉及展⽰ 四、功能详情 1.⾸⻚展⽰ 2.上传⽂件 2.1点击⼆级场景后，切换到新的标签⻚，展⽰如下：  2.2⽂件上传动画展⽰（最多同时展⽰1 0个⽂件，⽀持下划拉动查看，上传成功 有标记打√，个别⽂件失败打x并弹窗提⽰）  3.查看（修改）整理结果+溯源 3.1点击查看后，默认效果如下： 资质证照类⽂件展⽰内容： •ai提取的字段（即上图左边的⼩标题） •ai提取字段对应的内容（即上图右边的提取内容） •每份⽂件对应⼀个表格，且表格⾃动⽣成、⾃动隔开 •线上和线下的表格样式需要保持⼀致（字体、字号、⾏间距、缩进、加粗、底纹） 3.2图⽚切⽚溯源 切⽚和提取内容的对应样式可以参考这个。 理想化是能够在提取的内容⾥的每⼀句话后⾯展⽰来源图⽚，若⼀句话由多个⽚段组合⽽成，则需展 ⽰多份照⽚，每个照⽚对应不同的数字编号，hover在数字编号上时，会⾃动展⽰图⽚。  如果⽬前不好做，直接展⽰完整⽂件（不是图⽚切⽚，⽀持下划） 3.3⽂件溯源及修改 点击修改后，右侧⾯拉出修改⻚⾯，修改⻚⾯分两部分，左边是提取的表格，右边是原始⽂件的在线 溯源查看（ 参考样式，注意原始⽂件保持在右边，不是下图的左边： •表格的标题和提取内容都⽀持修改 •修改这部分跟表格提取结果是对应的，不⽤原内容和修改后内容这种体现修改，就直接标题和提取 内容 •溯源：pdf⽂件要⽀持下划切换⻚⾯的功能，原始⽂件为图⽚的要⽀持下划切换图⽚ •⽀持溯源⽂件的⽅向转换以及放⼤缩⼩ 四、数据需求 序号数据模块数据名称数据说明 1总览 xxxxxxx xxxxxxxxxxxx 2访问数据 xxxxxxx xxxxxxx 3收⼊数据 xxxxxxx xxxxxxx 4留存数据 数据在管理后台数据中⼼的展⽰模块及统计说明 五、上线计划及清单 计划2025.1.14提测，2025.1.16上线 序号端/系统功能模块功能点 功能说明 优先级 1 H5 法律研究 xxxxxxx xxxxxxxxxxxx p0 2⼩程序⽂书起草 xxxxx xxxxxx p1 3 Web 智爱gpt xxxxxxx xxxxxxx p0 4管理后台数据中⼼ xxxxxxx xxxxxxx p0 六、其他 其他备注说明",
        "analysis_result": {
            "functional_requirements": ['支持PDF和图片格式的文件上传', '支持批量拖动文件或点击批量文件上传',
                                        '后台任务执行完毕后可以查看整理结果', '下载整理结果为Word格式输出'],
            "non_functional_requirements": ['上传文件后有状态标记和失败提示弹窗',
                                            '查看结果时支持多表格展示及在线文档形式展示',
                                            '通过AI识别提取资质证照内容并自动摘录成表格',
                                            '溯源功能支持在提取内容中展示来源图片'],
            "test_scenarios": [
                {'id': 'TS001', 'description': '测试文件上传功能，包括pdf和图片格式的单个及批量上传', 'test_cases': []},
                {'id': 'TS002', 'description': '验证整理结果展示的正确性和多表格展示功能', 'test_cases': []},
                {'id': 'TS003', 'description': '测试溯源功能中的来源图片展示是否准确', 'test_cases': []},
                {'id': 'TS004', 'description': '检查下载结果的文件格式和命名是否符合要求', 'test_cases': []}],
            "risk_areas": ['文件上传失败可能导致用户体验不佳', 'AI识别提取的准确性可能影响整理结果的质量',
                           '多表格展示可能存在样式不一致问题', '溯源功能的性能可能影响系统响应速度']}
    }

    # 生成测试策略
    test_strategy = designer.design(requirements)
    print(test_strategy)